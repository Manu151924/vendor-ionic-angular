<ion-content>
  <ion-card class="custom-card">
  <div class="header-row">
    <ion-item lines="none" class="custom-dropdown">
      <ion-icon name="location" slot="start" color="success"></ion-icon>
      <ion-select [(ngModel)]="selectedCity" interface="popover" class="header-dropdown">
        @for(city of cities; track city){
          <ion-select-option [value]="city">{{ city }}</ion-select-option>
        }
      </ion-select>  
    </ion-item>
    <ion-note color="dark" class="header-note">
      WAYBILLS: 330PKGS : 670WT. (Ton) : 16
    </ion-note>
  </div>

  <div class="subtitle">AVL. INVENTORY</div>
  <div class="side-label">DLV. ROUTE WISE WB COUNT</div>
  <ngx-charts-bar-horizontal
    [results]="barData"
    [scheme]="colorScheme"
    [view]="[310, 150]"
    [roundEdges]="true"
    [barPadding]="10">
  </ngx-charts-bar-horizontal>
  <div class="footer-label">{{selectedCity}}</div>
</ion-card>

<div class="status-bar-row">
  <div class="status-pill">
    OFD: 330 | DELIVERED: 170 / PKG.400 / WT. 3 Ton
    <span class="undelivered-label">UN-DELIVERED: 120</span>
  </div>
  <ion-button class="today-btn" fill="solid" color="success" (click)="openCalendar()">
    Today
    <ion-icon name="calendar" slot="end"></ion-icon>
  </ion-button>
</div>


<div class="dashboard-container">
<div class="table-card">
  <div class="row-flex">
    <div class="trip-status-table">
      <div class="section-title">
        <ion-icon name="checkbox-outline"></ion-icon>
        Trip Status
        <span class="big-count green">7</span>
      </div>
      <div class="table-list">
        @for(t of displayedTripVehicles; track t.vehNo){
        <div  class="table-row">
          <span>{{t.vehNo}}</span>
          <span [ngClass]="t.statusColor">{{t.ofdStatus}}</span>
          <span>{{t.lastUpdated}}</span>
          <span><ion-icon name="location"></ion-icon></span>
        </div>
        }

      </div>
    </div>

    <div class="absent-table">
      <div class="section-title">
        <ion-icon name="car-outline"></ion-icon>
        Absent
        <span class="big-count red">2</span>
      </div>
      <div class="table-list">
        @for(a of displayedAbsentVehicles; track a.vehNo ){
        <div class="table-row">
          <span>{{a.vehNo}}</span>
          <span>{{a.lastTripDate}}</span>
        </div>
        }
      </div>
    </div>
  </div>

  <div class="expand-indicator" (click)="toggleExpansion()">
    <ion-icon 
      [name]="isExpanded ? 'chevron-up-outline' : 'chevron-down-outline'" 
      class="expand-check">
    </ion-icon>
  </div>
</div>


  <div class="kpi-row">
    <div class="kpi-card">
      <div class="kpi-main red">â‚¹ 52,348.00</div>
      <div class="kpi-label">To Be Collected <span class="mini">(As on)</span></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon-bg">
        <ion-icon name="document"></ion-icon>
              <div class="kpi-main">3</div>     
      </div>
      <div class="kpi-label">Pending POD's <span class="mini">(As on)</span></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon-bg">
        <ion-icon name="car-outline"></ion-icon>
        <div class="kpi-main">3</div>
      </div>
      
      <div class="kpi-label">Market Vehicle Usage <span class="mini">(Today)</span></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon-bg">
        <ion-icon name="shield-checkmark"></ion-icon>
        <div class="kpi-main green">76%</div>
      </div>
      
      <div class="kpi-label">Safedrop Usage <span class="mini">(Today)</span></div>
    </div>
  </div>
</div>


<!-- Use ion-datetime for calendar modal -->
<ion-modal [isOpen]="calendarOpen" (ionModalDidDismiss)="calendarOpen = false">
  <ion-content>
<ion-datetime
  [max]="maxDate"
  [min]="minDate"
  [value]="selectedDate.toISOString()"
  (ionChange)="tempSelectedDate = $event.detail.value">
</ion-datetime>


    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="cancelDate()">Cancel</ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ion-button (click)="confirmDate()">OK</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ion-content>
</ion-modal>
<ion-card class="snapshot-card">
  <div class="snapshot-header">
    <span class="snapshot-title">Month Wise Snapshot</span>
    <ion-button class="snapshot-dropdown" fill="solid" color="success" size="small">
      Aug-24
      <ion-icon name="chevron-down-outline" slot="end"></ion-icon>
    </ion-button>
  </div>
  <div class="snapshot-content">
    <div class="donut-section">
      <ngx-charts-pie-chart
        [results]="pieChartData"
        [scheme]="colorSchemeForPie"
        [doughnut]="true"
        [arcWidth]="0.5"
        [gradient]="false"
        [labels]="false"
        [legend]="false"
        [explodeSlices]="false"
        [animations]="true"
        [tooltipDisabled]="true"
        [view]="[120,120]">
      </ngx-charts-pie-chart>
      <div class="donut-legend">
        <div>
          <span class="delivered-label">Delivered</span>
          <span class="donut-stats">WB: 370<br/>Wt.: 16 Ton</span>
        </div>
        <div>
          <span class="undelivered-label">Un-Delivered</span>
          <span class="donut-stats">WB: 20<br/>Wt.: 1 Ton</span>
        </div>
      </div>
    </div>
    <div class="snapshot-bars">
      <div class="bar-section">
        <div class="bar-label-row">
          <span class="bar-title">Vehicle Attendance</span>
        </div>
        <div class="bar-bg">
          <div class="bar-fill attendance"></div>
        </div>
      </div>
      <div class="bar-section">
        <div class="bar-label-row">
          <span class="bar-title">Safedrop Usage</span>
          <span class="bar-percentage green"></span>
        </div>
        <div class="bar-bg">
          <div class="bar-fill safedrop"></div>
        </div>
      </div>
      <div class="bar-section">
        <div class="bar-label-row">
          <span class="bar-title">Market Vehicle Usage</span>
        </div>
        <div class="bar-bg">
          <div class="bar-fill market"></div>
        </div>
      </div>
    </div>
  </div>
</ion-card>
<div #progressWrapper class="progress-wrapper" (mousedown)="startDrag($event)" (mousemove)="onDrag($event)" (mouseup)="endDrag()" (mouseleave)="endDrag()">
  <div class="progress-bar">
    <div class="progress-fill" [style.width.%]="progressValue * 100"></div>
  </div>
  <div class="progress-emoji" [style.left.%]="progressValue * 100">{{ getHappinessFace() }}</div>
  <div class="progress-text">{{ (progressValue * 100) | number: '1.0-0' }}%</div>
</div>

</ion-content>




